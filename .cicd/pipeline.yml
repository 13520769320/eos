steps:
  - wait

  - label: ":pipeline: Generate Pipeline Steps"
    command:
      - "ssh-keyscan -H github.com >> ~/.ssh/known_hosts"
      - "git clone https://github.com/EOSIO/eos -b $BUILDKITE_BRANCH --single-branch --depth 2 --filter=blob:none ."
      - "git checkout $BUILDKITE_COMMIT -- .cicd"
      - "./.cicd/generate-pipeline.sh > generated-pipeline.yml"
      - "buildkite-agent pipeline upload < generated-pipeline.yml"
      - "buildkite-agent artifact upload generated-pipeline.yml"
    plugins:
      - thedyrt/skip-checkout#v0.1.1:
          cd: ~
    agents:
      queue: "automation-basic-builder-fleet"
    timeout: ${TIMEOUT:-10}